<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://primefaces.org/ui">
<h:head>
	<title>Coffey Atlas</title>
</h:head>
<h:body >
<f:view contentType="text/html" locale="#{atlasTranslator.getStaticLocale()}">
	<h:outputStylesheet library="css" name="common.css"  />
	<div style="height: 50px;">
		<ui:include src="/common/menu.xhtml" />
		<ui:include src="/common/loadingStatus.xhtml" />
		<p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()"/>
	</div>
	<div id="divContentPage" align="center" style="background-color:  #FEFEFE; height: 90%; overflow-y:scroll;">
		<!-- HEADER  -->
		<h:form id="formList" >
			<div style="width: 80%;" align="left">
				<p:growl id="messages" showDetail="false" sticky="false" life="6500" />  
				<h:panelGrid columns="1" cellpadding="5">
					<p:commandButton value="#{translator['LABEL_ADD_ON']}" styleClass="buttonAdd" id="openCrudButton" actionListener="#{projectView.clearEntity}" oncomplete="PF('entityCreateWindow').show()" update=":formList :crudForm" />
				</h:panelGrid>
				<h:panelGrid columns="1" cellpadding="5" id="projectPanelCrud" >
					<p:dataTable paginatorPosition="bottom" id="entityListDT" var="project" value="#{projectView.entityList}" paginator="true" rows="10" rowKey="#{project.id}" emptyMessage="#{translator['MESSAGE_NO_RECORD_FOUND']}">
						<f:facet name="header">#{translator['LABEL_THEMES']}</f:facet>
						<p:column headerText="#{translator['LABEL_NAME']}">
							<h:outputText value="#{project.name}" />
						</p:column>
						<p:column headerText="#{translator['LABEL_PARENT_PROJECT']}">
							<h:outputText value="#{project.parentProject.name}" />
						</p:column>
						<p:column headerText="#{translator['LABEL_EDIT']}" width="6%">
							<div align="center">
							   <p:commandLink action="#{projectView.editEntity}" oncomplete="PF('entityCreateWindow').show()" update=":crudForm :formList" ajax="true">
							   	  <h:graphicImage value="/resources/img/edit.png" width="15px;" height="15px;" />
							      <f:setPropertyActionListener target="#{projectView.entity}" value="#{project}" />
							   </p:commandLink>
							</div>
						</p:column>
						<p:column headerText="#{translator['LABEL_DELETE']}" width="6%">
							<div align="center">
								<p:commandLink action="#{projectView.deleteEntity}" update=":crudForm :formList" ajax="true">
									<h:graphicImage value="/resources/img/remove.png" width="19px;" height="15px;" />
									<f:setPropertyActionListener target="#{projectView.entitySelected}" value="#{project}" />
								</p:commandLink>
							</div>
						</p:column>
						<f:facet name="footer"><h:outputText value="#{translator['MESSAGE_TOTAL_RECORDS']}: #{projectView.entityListSize}"/></f:facet>
					</p:dataTable>
				</h:panelGrid>
			</div>
		</h:form>
		<!-- Dialog -->
		<p:dialog closeOnEscape="true" id="entityCreateModal" header="#{translator['LABEL_THEME']}" widgetVar="entityCreateWindow" showEffect="fade" hideEffect="fade" modal="true" height="70%" width="70%" onHide="">
			<h:form id="crudForm">
				&nbsp;<h:outputLabel for="projectNome" value="#{translator['LABEL_NAME']}"/>&nbsp;&nbsp;
				<h:message for="projectNome" style="color: red; font-size: 11px; font-weight: bold;" /><br />
				<p:inputText id="projectNome" value="#{projectView.entity.name}" styleClass="inputValue" validatorMessage="#{translator['MESSAGE_FIELD_REQUIRED']} #{translator['MESSAGE_MAX_LENGTH_IN_CHARACTERS']} 250" >
					<f:validateRequired />
					<f:validateLength maximum="250"/>
				</p:inputText><br /><br />
				&nbsp;<h:outputLabel for="projectParent" value="#{translator['LABEL_PARENT_PROJECT']}" />&nbsp;&nbsp;
				<h:message for="projectParent" style="color: red; font-size: 11px; font-weight: bold;" /><br />
				<p:autoComplete id="projectParent" value="#{projectView.entity.parentProject}" completeMethod="#{projectView.filterProjects}"
                        		var="parentProjectVar" itemLabel="#{parentProjectVar.name}" itemValue="#{parentProjectVar}" converter="#{projectView}" 
                        		forceSelection="true" styleClass="ui-autocomplete" scrollHeight="150"/><br /><br />
           		<!-- ############# PROJETOS FILHOS ################## -->
           		<p:dataTable id="childrensProjects" var="project" value="#{projectView.childrensProjects}" paginator="true" rows="5" paginatorPosition="bottom" style="width: 82%;" rendered="#{projectView.childrensProjects.size() > 0}" >
		        	<f:facet name="header">#{translator['LABEL_CHILDREN_PROJECTS']}</f:facet>
		            <p:column headerText="#{translator['LABEL_NAME']}" >
		           		<div align="left">
			                <h:outputText value="#{project.name}" />
					    </div>
		            </p:column>
		        </p:dataTable>
           		<!-- ############# PROJETOS FILHOS ################## -->
				
				<div align="left">
				<h:panelGrid id="display" columns="1" cellpadding="4">

					<h:panelGrid columns="2" cellpadding="5">
						<p:tabView id="tabViewProjects" widgetVar="tabViewProjects" effect="fade" effectDuration="normal">
							<p:tab id="tabMetadataLayers" title="&nbsp;&nbsp;&nbsp;#{translator['LABEL_METADATAS']}&nbsp;&nbsp;" rendered="#{not empty projectView.entitySelected}" titleStyleClass="metadataTitle">
								<h:panelGrid columns="1" cellpadding="5" id="metadataPanelGrid02">
									<p:column id="metadataColumn">
										<div align="center">
											<br />
											<p:outputLabel for="serverList" value="#{translator['LABEL_SERVER']}: " style="margin-bottom: 15px;" />
											<p:selectOneMenu id="serverList" value="#{projectView.serverSelected}">
												<f:selectItem itemLabel="DataGEO" itemValue="DataGEO" />
											</p:selectOneMenu>
											<br />
											<p:outputLabel for="fieldList" value="#{translator['LABEL_FIELDS']}:  " style="margin-bottom: 15px;" />
											<p:selectOneMenu id="fieldList" value="#{projectView.fieldSelected}">
												<f:selectItem itemLabel="#{translator['LABEL_ALL']}" itemValue="anytext" />
												<f:selectItem itemLabel="#{translator['LABEL_TITLE']}" itemValue="title" />
												<f:selectItem itemLabel="#{translator['LABEL_SUBJECT']}" itemValue="subject" />
											</p:selectOneMenu>
											<br />
											<p:inputText id="searchText" value="#{projectView.searchText}" />
											&nbsp;
											<p:commandButton value="&nbsp;" id="searchButton" actionListener="#{projectView.sendCswRequest}" process="@this :crudForm:tabViewProjects:searchText :crudForm:tabViewProjects:fieldList" update=":crudForm:tabViewProjects:availabelMetadatas" styleClass="searchIcon" />
											<br /> <br />
										</div>
										<p:dataTable paginatorPosition="bottom" id="availabelMetadatas" var="metadata" value="#{projectView.metadataList}" paginator="true"
											rows="5" rowKey="#{metadata.name}" selection="#{projectView.metadataSelected}" selectionMode="single" emptyMessage="#{translator['MESSAGE_NO_METADATA_FOUND']}">
											<f:facet name="header">#{translator['LABEL_METADATAS']}</f:facet>
											<p:ajax event="rowSelect" process="@this" listener="#{projectView.onMeadataSelected}" oncomplete="PF('metadataCreateWindow').show()" update=":metadataCreateModal" />
											<p:column headerText="#{translator['LABEL_NAME']}">
												<h:outputText value="#{metadata.name}" />
											</p:column>
											<f:facet name="footer">#{translator['LABEL_TOTAL_REGISTERS']} #{projectView.metadataList.size()}</f:facet>
										</p:dataTable>
									</p:column>
								</h:panelGrid>
							</p:tab>
							<p:tab id="tabLayers" title="&nbsp;&nbsp;&nbsp;#{translator['LABEL_LAYERS']}&nbsp;&nbsp;" rendered="#{not empty projectView.entitySelected}" titleStyleClass="layerTitle">
								<h:panelGrid columns="1" cellpadding="5" id="layerPanelGrid02">

									<p:dataTable paginatorPosition="bottom" id="availabelLayers" var="layer" value="#{projectView.layersDisassociated}"
										paginator="true" rows="5" rowKey="#{layer.id}" selection="#{projectView.layerToDetail}" selectionMode="single" emptyMessage="#{translator['MESSAGE_NO_RECORD_FOUND']}">
										<p:ajax event="rowSelect" process="@this" listener="#{projectView.onSelectLayer}" oncomplete="PF('layerCreateWindow').show()" update=":layerCreateModal" />
										<f:facet name="header">#{translator['LABEL_LAYERS_AVAILABLE']}</f:facet>

										<p:column style="width:20px">
											<p:commandLink action="#{projectView.associateLayer}" update=":crudForm:tabViewProjects:availabelLayers :crudForm:selectedLayersTable" ajax="true">
												<div align="center">
													<h:graphicImage value="/resources/img/link.png" />
													<f:setPropertyActionListener target="#{projectView.layerSelected}" value="#{layer}" />
												</div>
											</p:commandLink>
										</p:column>

										<p:column headerText="#{translator['LABEL_NAME']}" filterBy="#{layer.name}" filterMatchMode="contains" filterStyle="width: 200px!important;" >
											<h:outputText value="#{layer.name}" />
										</p:column>

									</p:dataTable>

								</h:panelGrid>
							</p:tab>
						</p:tabView>

						<p:dataTable paginatorPosition="bottom" id="selectedLayersTable" var="layer" value="#{projectView.layersAssociated}" 
									 paginator="true" rows="8" rowKey="#{layer.id}" selection="#{projectView.layerToDetail}" selectionMode="single" emptyMessage="#{translator['MESSAGE_NO_RECORD_FOUND']}">
							<p:ajax event="rowSelect" process="@this" listener="#{projectView.onSelectLayer}" oncomplete="PF('layerCreateWindow').show()" update=":layerCreateModal" />
							<f:facet name="header">#{translator['LABEL_LAYERS_SELECTED']}</f:facet>

							<p:column style="width:20px">
								<div align="center">
									<p:commandLink action="#{projectView.disassociateLayer}" ajax="true" update=":crudForm:tabViewProjects:availabelLayers :crudForm:selectedLayersTable">
										<h:graphicImage value="/resources/img/remove.png" width="19px;" height="15px;" />
										<f:setPropertyActionListener target="#{projectView.layerSelected}" value="#{layer}" />
									</p:commandLink>
								</div>
							</p:column>

							<p:column headerText="#{translator['LABEL_NAME']}" filterBy="#{layer.name}" filterMatchMode="contains" filterStyle="width: 200px!important;" >
								<h:graphicImage value="/resources/img/layer.png" height="18px" width="18px" rendered="#{empty layer.metadataCode}" /> 
								<h:graphicImage value="/resources/img/metadata.png" height="18px" width="18px" rendered="#{not empty layer.metadataCode}" /> &nbsp;
								<h:outputText value="#{layer.name}" />
							</p:column>
						</p:dataTable>
					</h:panelGrid>
				</h:panelGrid>
	
			    <!-- ################# CAMADAS ###################### -->
				<h:inputHidden id="id" value="#{projectView.entity.id}" />
				<br />
			</div>
			<p:commandButton value="#{translator['LABEL_SAVE']}" update=":crudForm :formList" id="saveButton" actionListener="#{projectView.saveOrUpdateEntity}" styleClass="ui-priority-primary" />
		</h:form>
	</p:dialog>
	<!-- ### ### DETALHES DA CAMADA ### ### ###-->
	<p:dialog closeOnEscape="true" id="layerCreateModal" header="#{projectView.layerToDetail.name}" widgetVar="layerCreateWindow" showEffect="fade" hideEffect="fade" modal="true" height="70%" width="70%" >
		<div align="left">
			<p:messages id="dialogMessageLayer" showDetail="false" autoUpdate="true" closable="true"  />
			<h:panelGrid id="layerDisplay" columns="2" cellpadding="4" rendered="#{empty projectView.layerToDetail.metadataCode}"> 
				<h:outputText value="#{translator['LABEL_CODE']}:" />
            	<h:outputText value="#{projectView.layerToDetail.code}" />
            	
				<h:outputText value="#{translator['LABEL_DESCRIPTION']}:" />
            	<h:outputText value="#{projectView.layerToDetail.description}" />
            	
				<h:outputText value="#{translator['LABEL_LAYER_TYPE']}:" />
            	<h:outputText value="#{projectView.layerToDetail.typeLayerLabel()}" />
            	
            	<h:outputText value="#{translator['LABEL_PROJECTION']}:" />
            	<h:outputText value="#{projectView.layerToDetail.projection}" />
            	
				<h:outputText value="#{translator['LABEL_URL']}:" />
            	<h:outputText value="#{projectView.layerToDetail.url}" />
            	
				<h:outputText value="#{translator['LABEL_BBOX']}:" />
            	<h:outputText value="#{projectView.layerToDetail.bbox}" />
            	
	        </h:panelGrid>
	        
			<h:panelGrid id="layerDisplayMetadata" columns="1" cellpadding="4" rendered="#{not empty projectView.layerToDetail.metadataCode}">
	        	<div align="left">
				
					<h:panelGrid id="label_data02" columns="2" cellpadding="4">
				 
						<h:outputText value="#{translator['LABEL_CODE']}:" />
		            	<h:outputText value="#{projectView.metadataSelected.code}" />
		            	
		            	<h:outputText value="#{translator['LABEL_ABSTRACT']}:" />
		            	<h:outputText value="#{projectView.metadataSelected.description}" />
		            	
		            	<h:outputText value="#{translator['LABEL_METADATA_NAME']}:" />
		            	<h:outputText value="#{projectView.metadataSelected.metadataStandardName}" />
		            	
		            	<h:outputText value="#{translator['LABEL_CODE']}:" />
		            	<h:outputText value="#{projectView.metadataSelected.metadataStandardVersion}" />
		            	
		            	<h:outputText value="#{translator['LABEL_LANGUAGE']}:" />
		            	<h:outputText value="#{projectView.metadataSelected.language}" />
		            	
		            	<h:outputText value="#{translator['LABEL_DATE']}:" />
		            	<h:outputText value="#{projectView.metadataSelected.getDateFormated()}" />

			        </h:panelGrid>
			        
			        <p:dataTable id="metadataWmsUrlTable02" var="wmsUrl" value="#{projectView.metadataSelected.wmsUrls}" rendered="#{not empty projectView.metadataSelected.wmsUrls}">
		            	<f:facet name="header">#{translator['LABEL_WMS_LAYERS']}</f:facet>

						<p:column headerText="#{translator['LABEL_URL']}">
		                    <h:outputText value="#{wmsUrl.url}" />
		                </p:column>
		                
		            </p:dataTable>
			        <br />
			        <h:panelGrid id="boundingBoxGrid02" columns="3" cellpadding="4" width="100%;">
			        
		            	<h:outputText value="" />
		            	<h:outputText value="North Bounding Latitude [ #{projectView.metadataSelected.northBoundLatitude} ]" />
		            	<h:outputText value="" />
		            	
		            	<h:outputText value="West Bounding Latitude [ #{projectView.metadataSelected.westBoundLatitude} ]" />
		            	<h:outputText value="" />
		            	<h:outputText value="East Bounding Latitude [ #{projectView.metadataSelected.eastBoundLatitude} ]" />
		            	
		            	<h:outputText value="" />
		            	<h:outputText value="South Bounding Latitude [ #{projectView.metadataSelected.southBoundLatitude} ]" />
		            	<h:outputText value="" />
		            	
		            </h:panelGrid>
		            <br />
		            <p:dataTable id="metadataContactTable02" var="contact" value="#{projectView.metadataSelected.contacts}" rendered="#{not empty projectView.metadataSelected.contacts}" 
		            	paginator="true" rows="3" paginatorPosition="bottom">
		            	<f:facet name="header">#{translator['LABEL_CONTACT']}</f:facet>

						<p:column headerText="#{translator['LABEL_ORGANIZATION_NAME']}">
		                    <h:outputText value="#{contact.organizationName}" />
		                </p:column>
						<p:column headerText="#{translator['LABEL_FUNCTION']}">
		                    <h:outputText value="#{contact.functionName}" />
		                </p:column>
		                
		            </p:dataTable>
		            
			    </div>
	        </h:panelGrid>
	    </div>
    </p:dialog> 
	<!-- ### ### ### ### ### ### ### ### ### ### ###-->
	<!-- ### ### ## DETALHES METADADO ## ### ### ###-->
	<p:dialog closeOnEscape="true" id="metadataCreateModal" header="#{projectView.metadataSelected.name}" widgetVar="metadataCreateWindow" showEffect="fade" hideEffect="fade" modal="true" height="70%" width="70%"  >
		<div align="left">
			<p:messages id="dialogMessage" showDetail="false" autoUpdate="true" closable="true"  />
			<h:panelGrid id="metadataDisplay" columns="1" cellpadding="4">
			
				<h:panelGrid id="label_data" columns="2" cellpadding="4">
			 
					<h:outputText value="#{translator['LABEL_CODE']}:" />
	            	<h:outputText value="#{projectView.metadataSelected.code}" />
	            	
	            	<h:outputText value="#{translator['LABEL_ABSTRACT']}:" />
	            	<h:outputText value="#{projectView.metadataSelected.description}" />
	            	
	            	<h:outputText value="#{translator['LABEL_METADATA_NAME']}:" />
	            	<h:outputText value="#{projectView.metadataSelected.metadataStandardName}" />
	            	
	            	<h:outputText value="#{translator['LABEL_METADATA_VERSION']}:" />
	            	<h:outputText value="#{projectView.metadataSelected.metadataStandardVersion}" />
	            	
	            	<h:outputText value="#{translator['LABEL_LANGUAGE']}:" />
	            	<h:outputText value="#{projectView.metadataSelected.language}" />
	            	
	            	<h:outputText value="#{translator['LABEL_DATE']}:" />
	            	<h:outputText value="#{projectView.metadataSelected.getDateFormated()}" />

		        </h:panelGrid>
		        
		        <p:dataTable id="metadataWmsUrlTable" var="wmsUrl" value="#{projectView.metadataSelected.wmsUrls}" rendered="#{not empty projectView.metadataSelected.wmsUrls}">
	            	<f:facet name="header">#{translator['LABEL_WMS_LAYERS']}</f:facet>

					<p:column style="width:20px">
	                    <p:commandLink process="@this" action="#{projectView.associateMetadataLayer}" update=":crudForm:selectedLayersTable" ajax="true" title="Associar camada ao projeto: #{projectView.entitySelected.name}">
							<div align="center">
		                		<h:graphicImage value="/resources/img/link.png" />
		                		<f:setPropertyActionListener target="#{projectView.wmsUrlSelected}" value="#{wmsUrl}" />
							</div>
						</p:commandLink>
	                </p:column>
	                
					<p:column headerText="#{translator['LABEL_URL']}">
	                    <h:outputText value="#{wmsUrl.url}" />
	                </p:column>
	                
	            </p:dataTable>
		        <br />
		        <h:panelGrid id="boundingBoxGrid" columns="3" cellpadding="4" width="100%;">
		        
	            	<h:outputText value="" />
	            	<h:outputText value="North Bounding Latitude [ #{projectView.metadataSelected.northBoundLatitude} ]" />
	            	<h:outputText value="" />
	            	
	            	<h:outputText value="West Bounding Latitude [ #{projectView.metadataSelected.westBoundLatitude} ]" />
	            	<h:outputText value="" />
	            	<h:outputText value="East Bounding Latitude [ #{projectView.metadataSelected.eastBoundLatitude} ]" />
	            	
	            	<h:outputText value="" />
	            	<h:outputText value="South Bounding Latitude [ #{projectView.metadataSelected.southBoundLatitude} ]" />
	            	<h:outputText value="" />
	            	
	            </h:panelGrid>
	            <br />
	            <p:dataTable id="metadataContactTable" var="contact" value="#{projectView.metadataSelected.contacts}" rendered="#{not empty projectView.metadataSelected.contacts}" 
	            	paginator="true" rows="3" paginatorPosition="bottom">
	            	<f:facet name="header">#{translator['LABEL_CONTACT']}</f:facet>

					<p:column headerText="#{translator['LABEL_ORGANIZATION_NAME']}">
	                    <h:outputText value="#{contact.organizationName}" />
	                </p:column>
					<p:column headerText="#{translator['LABEL_FUNCTION']}">
	                    <h:outputText value="#{contact.functionName}" />
	                </p:column>
	                
	            </p:dataTable>
	            
	        </h:panelGrid>
	    </div>
    </p:dialog> 
	<!-- ### ### ### ### ### ### ### ### ### ### ###-->
	</div>
</f:view>	
</h:body>
</html>
